FROM ubuntu:16.04
ENV DEBIAN_FRONTEND=noninteractive
MAINTAINER Christian Brandt <christian.jena@gmail.com

RUN apt-get update && \
    apt-get upgrade -y perl && \
    apt-get install -y parallel make wget git python-pip locales && \
    pip install --upgrade pip && \
    pip install -U setuptools  

# install correct conda version for plasflow
RUN wget --no-check-certificate https://repo.continuum.io/miniconda/Miniconda3-4.5.11-Linux-x86_64.sh
RUN bash Miniconda3-4.5.11-Linux-x86_64.sh -b -p /conda
RUN rm -f Miniconda3-4.5.11-Linux-x86_64.sh

RUN ln -s /conda/etc/profile.d/conda.sh /etc/profile.d/conda.sh && \
    echo ". /conda/etc/profile.d/conda.sh" >> ~/.bashrc && \
    echo "conda activate base" >> ~/.bashrc 

ENV PATH /conda/bin:$PATH
# install plasflow
RUN conda config --add channels bioconda
RUN conda config --add channels conda-forge
RUN conda install plasflow -c smaegol
RUN conda install -c bioconda perl-bioperl perl-getopt-long
# modify shebangs for bioperl
RUN sed -i '1i#!/conda/bin/perl' /conda/bin/filter_sequences_by_length.pl
